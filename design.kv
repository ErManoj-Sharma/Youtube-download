#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp

#:kivy 2.0

<QualityButton@ToggleButton>:
    background_normal: ''
    background_down: ''
    size_hint_y: None
    height: dp(50)
    font_size: sp(14)
    bold: True


<YouTubeDownloader>:
    orientation: 'vertical'
    padding: [dp(16), dp(20), dp(16), dp(20)]
    spacing: 0

    canvas.before:
        Color:
            rgba: 0.08, 0.08, 0.08, 1
        Rectangle:
            pos: self.pos
            size: self.size

    # SCROLLABLE CONTAINER FOR MOBILE
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True

        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: self.minimum_height
            spacing: 0
            padding: [dp(8), 0, dp(8), 0]

            # Top spacer
            Widget:
                size_hint_y: None
                height: dp(20)

            # Header
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: dp(85)
                spacing: dp(5)

                Label:
                    text: 'YouTube Downloader'
                    font_size: sp(26)
                    bold: True
                    color: 1, 1, 1, 1
                    size_hint_y: None
                    height: dp(50)

                Label:
                    text: 'Download videos or audio easily'
                    font_size: sp(13)
                    color: 0.55, 0.55, 0.55, 1
                    size_hint_y: None
                    height: dp(30)

            Widget:
                size_hint_y: None
                height: dp(25)

            # URL INPUT
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: dp(90)
                spacing: dp(10)

                Label:
                    text: 'YouTube Video URL'
                    font_size: sp(14)
                    bold: True
                    color: 1, 1, 1, 1
                    size_hint_y: None
                    height: dp(25)
                    halign: 'left'
                    text_size: self.size

                BoxLayout:
                    size_hint_y: None
                    height: dp(50)
                    spacing: 0
                    canvas.before:
                        Color:
                            rgba: 0.18, 0.18, 0.18, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                    TextInput:
                        id: url_input
                        hint_text: 'Paste YouTube link here...'
                        hint_text_color: 0.45, 0.45, 0.45, 1
                        multiline: False
                        background_normal: ''
                        background_active: ''
                        background_color: 0, 0, 0, 0
                        foreground_color: 0.95, 0.95, 0.95, 1
                        cursor_color: 0.85, 0.25, 0.25, 1
                        padding: [dp(15), dp(13), dp(15), dp(13)]
                        font_size: sp(14)
                        on_text: root.on_url_change(self.text)

                    Button:
                        text: 'Paste'
                        size_hint_x: None
                        width: dp(80)
                        background_normal: ''
                        background_color: 0, 0, 0, 0
                        color: 0.65, 0.65, 0.65, 1
                        font_size: sp(14)
                        on_release: root.on_paste_click()

            Widget:
                size_hint_y: None
                height: dp(20)

            # QUALITY SELECTION
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: dp(160)
                spacing: dp(10)

                Label:
                    text: 'Select Video Quality'
                    font_size: sp(14)
                    bold: True
                    color: 1, 1, 1, 1
                    size_hint_y: None
                    height: dp(25)
                    halign: 'left'
                    text_size: self.size

                GridLayout:
                    cols: 2
                    spacing: dp(10)
                    size_hint_y: None
                    height: dp(110)

                    QualityButton:
                        text: 'Max Available'
                        group: 'quality'
                        state: 'down' if root.quality_selected == 'max' else 'normal'
                        disabled: root.audio_only
                        on_release: root.on_quality_select('max')
                        background_color: (0.18, 0.18, 0.18, 1) if not self.disabled else (0.28, 0.28, 0.28, 1)
                        color: 1, 1, 1, 1  if not self.disabled else (0.4, 0.4, 0.4, 1)
                        canvas.before:
                            Color:
                                rgba: (0.65, 0.15, 0.15, 1) if self.state == 'down' and not self.disabled else (0.22, 0.22, 0.22, 1)
                            Rectangle:
                                pos: self.pos
                                size: self.size
                            Color:
                                rgba: (0.9, 0.25, 0.25, 1) if self.state == 'down' and not self.disabled else (0, 0, 0, 0)
                            Line:
                                rectangle: self.x, self.y, self.width, self.height
                                width: dp(2.5)

                    QualityButton:
                        text: '1080p'
                        group: 'quality'
                        state: 'down' if root.quality_selected == '1080p' else 'normal'
                        disabled: root.audio_only
                        on_release: root.on_quality_select('1080p')
                        background_color: (0.18, 0.18, 0.18, 1) if not self.disabled else (0.28, 0.28, 0.28, 1)
                        color: 1, 1, 1, 1  if not self.disabled else (0.4, 0.4, 0.4, 1)
                        canvas.before:
                            Color:
                                rgba: (0.65, 0.15, 0.15, 1) if self.state == 'down' and not self.disabled else (0.22, 0.22, 0.22, 1)
                            Rectangle:
                                pos: self.pos
                                size: self.size
                            Color:
                                rgba: (0.9, 0.25, 0.25, 1) if self.state == 'down' and not self.disabled else (0, 0, 0, 0)
                            Line:
                                rectangle: self.x, self.y, self.width, self.height
                                width: dp(2.5)

                    QualityButton:
                        text: '720p'
                        group: 'quality'
                        state: 'down' if root.quality_selected == '720' else 'normal'
                        disabled: root.audio_only
                        on_release: root.on_quality_select('720')
                        background_color: (0.18, 0.18, 0.18, 1) if not self.disabled else (0.28, 0.28, 0.28, 1)
                        color: 1, 1, 1, 1 if not self.disabled else (0.4, 0.4, 0.4, 1)
                        canvas.before:
                            Color:
                                rgba: (0.65, 0.15, 0.15, 1) if self.state == 'down' and not self.disabled else (0.22, 0.22, 0.22, 1)
                            Rectangle:
                                pos: self.pos
                                size: self.size
                            Color:
                                rgba: (0.9, 0.25, 0.25, 1) if self.state == 'down' and not self.disabled else (0, 0, 0, 0)
                            Line:
                                rectangle: self.x, self.y, self.width, self.height
                                width: dp(2.5)

                    QualityButton:
                        text: '480p'
                        group: 'quality'
                        state: 'down' if root.quality_selected == '480' else 'normal'
                        disabled: root.audio_only
                        on_release: root.on_quality_select('480')
                        background_color: (0.18, 0.18, 0.18, 1) if not self.disabled else (0.28, 0.28, 0.28, 1)
                        # text-color
                        color: 1, 1, 1, 1 if not self.disabled else (0.4, 0.4, 0.4, 1)
                        canvas.before:
                            Color:
                                rgba: (0.65, 0.15, 0.15, 1) if self.state == 'down' and not self.disabled else (0.22, 0.22, 0.22, 1)
                            Rectangle:
                                pos: self.pos
                                size: self.size
                            Color:
                                rgba: (0.9, 0.25, 0.25, 1) if self.state == 'down' and not self.disabled else (0, 0, 0, 0)
                            Line:
                                rectangle: self.x, self.y, self.width, self.height
                                width: dp(2.5)

            Widget:
                size_hint_y: None
                height: dp(20)

            # AUDIO TOGGLE
            BoxLayout:
                size_hint_y: None
                height: dp(75)
                padding: [dp(18), dp(15), dp(18), dp(15)]
                spacing: dp(15)
                canvas.before:
                    Color:
                        rgba: 0.18, 0.18, 0.18, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(3)

                    Label:
                        text: 'Download Options'
                        bold: True
                        font_size: sp(15)
                        color: 1, 1, 1, 1
                        size_hint_y: None
                        height: dp(24)
                        halign: 'left'
                        text_size: self.size

                    Label:
                        text: 'Audio Only (MP3)'
                        font_size: sp(13)
                        color: 0.55, 0.55, 0.55, 1
                        size_hint_y: None
                        height: dp(22)
                        halign: 'left'
                        text_size: self.size

                Switch:
                    size_hint_x: None
                    width: dp(70)
                    active: root.audio_only
                    on_active: root.on_audio_toggle(self.active)

            Widget:
                size_hint_y: None
                height: dp(15)

            # ERROR / SUCCESS
            Label:
                text: root.error_message if root.error_message else root.success_message
                font_size: sp(13)
                color: (1, 0.35, 0.35, 1) if root.error_message else (0.35, 0.9, 0.45, 1)
                size_hint_y: None
                height: dp(30)
                opacity: 1 if (root.error_message or root.success_message) else 0

            Widget:
                size_hint_y: None
                height: dp(10)

            # PROGRESS BAR
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: dp(50) if root.is_loading else 0
                opacity: 1 if root.is_loading else 0
                spacing: dp(6)

                BoxLayout:
                    size_hint_y: None
                    height: dp(10)
                    canvas.before:
                        Color:
                            rgba: 0.18, 0.18, 0.18, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                        Color:
                            rgba: 0.72, 0.15, 0.15, 1
                        Rectangle:
                            pos: self.x, self.y
                            size: self.width * (root.download_progress / 100), self.height

                Label:
                    text: f'{int(root.download_progress)}%' if not root.current_item else f'{int(root.download_progress)}% - {root.current_item}'
                    font_size: sp(12)
                    color: 0.75, 0.75, 0.75, 1
                    size_hint_y: None
                    height: dp(25)
                    halign: 'center'
                    valign: 'middle'
                    text_size: self.size
                    shorten: True
                    shorten_from: 'right'

            Widget:
                size_hint_y: None
                height: dp(10)

            # DOWNLOAD BUTTON
            Button:
                text: '‚è≥ Downloading...' if root.is_loading else 'üì• Download'
                size_hint_y: None
                height: dp(55)
                disabled: root.is_loading or root.url_text == ''
                background_normal: ''
                background_color: (0.72, 0.15, 0.15, 1) if not self.disabled else (0.28, 0.28, 0.28, 1)
                color: 1, 1, 1, 1
                bold: True
                font_size: sp(16)
                on_release: root.start_download()

            Widget:
                size_hint_y: None
                height: dp(15)

            # FOOTER
            Label:
                text: 'Paste a YouTube link and select your preferred quality to download.' if not root.audio_only else ('Audio will be saved as MP3' if not root.audio_only else 'Audio will be saved in m4a/webm format on Android')
                font_size: sp(12)
                color: 0.45, 0.45, 0.45, 1
                size_hint_y: None
                height: dp(40)
                halign: 'center'
                valign: 'middle'
                text_size: self.size